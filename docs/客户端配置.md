# 📱 客户端配置指南

本文档介绍如何在播放器客户端中配置弹幕接口,以便使用本服务提供的弹幕功能。

## 📋 目录

1. [获取弹幕Token](#获取弹幕token)
2. [配置弹幕接口](#配置弹幕接口)
3. [支持的播放器](#支持的播放器)
4. [常见问题](#常见问题)

---

## 获取弹幕Token

### 步骤1: 创建Token

1. 打开 Web UI,进入 **"弹幕" → "Token管理"** 页面
2. 点击 **"创建Token"** 按钮
3. 填写Token信息:
   - **Token名称**: 用于识别Token的名称(如 "我的播放器")
   - **有效期**: 选择Token的有效期(如 30天、90天、永久)
   - **每日调用限制**: 设置每日最大调用次数(可选)
4. 点击 **"确认"** 创建

### 步骤2: 复制Token

创建成功后,您会得到一串随机字符,这就是您的弹幕Token。

**快捷复制**:
- 如果您已配置自定义域名,可以直接点击 **"复制"** 按钮
- 系统会自动拼接好完整的弹幕接口地址

---

## 配置弹幕接口

### 接口格式

在播放器的自定义弹幕接口设置中,填入以下格式的地址:

```
http://<服务器IP>:<端口>/api/v1/<你的Token>
```

**参数说明**:
- `<服务器IP>`: 部署本服务的主机IP地址
- `<端口>`: 部署本服务时设置的端口(默认为 `7768`)
- `<你的Token>`: 您在上一步中创建的Token字符串

### 配置示例

假设您的服务部署在 `192.168.1.100`,端口为 `7768`,创建的Token是 `Q2KHYcveM0SaRKvxomQm`。

**标准格式**:
```
http://192.168.1.100:7768/api/v1/Q2KHYcveM0SaRKvxomQm
```

**兼容格式** (部分播放器需要):
```
http://192.168.1.100:7768/api/v1/Q2KHYcveM0SaRKvxomQm/api/v2
```

> **兼容性说明**: 本服务已对路由进行特殊处理,无论您使用 `.../api/v1/<Token>` 还是 `.../api/v1/<Token>/api/v2` 格式,服务都能正确响应,以最大程度兼容不同客户端。

---

## 支持的播放器

### 播放器兼容性一览

| 播放器 | 平台 | 最低版本 | 自动匹配(match) | 手动搜索(anime) | 手动搜索(episodes) | 推荐度 | 备注 |
|--------|------|---------|----------------|----------------|-------------------|--------|------|
| **Yamby** | Android | 1.5.9.11 | ❌ | ✅ | ❌ | ⭐⭐⭐⭐⭐ | - |
| **Hills** | Android/Windows | 1.4.2/0.2.8 | ✅ | ✅ | ❌ | ⭐⭐⭐⭐⭐ | - |
| **小幻影视** | Windows | 无要求 | ✅ | ✅ | ❌ | ⭐⭐⭐⭐⭐ | - |
| **SenPlayer** | iOS | 5.7 | ✅ | ✅ | ❌ | ⭐⭐⭐⭐⭐ | - |
| **Afusekt** | Android/Android TV | 2.9.6 | ✅ | ✅ | ✅ | ⭐⭐⭐⭐⭐ | - |
| **dd-danmaku (chen3861229)** | 浏览器/客户端/服务端插件 | 1.47 | ✅ | ❌ | ✅ | ⭐⭐⭐⭐ | 可注入emby服务端web页面、windows/macos官方/小秘客户端 |
| **dd-danmaku (l429609201)** | 浏览器/客户端/服务端插件 | 1.0.0 | ✅ | ✅ | ❌ | ⭐⭐⭐⭐ | 可注入emby服务端web页面、windows/macos官方/小秘客户端 |
| **其他播放器** | - | - | ⚠️ 视播放器而定 | ⚠️ 视播放器而定 | ⚠️ 视播放器而定 | - | 支持dandanplayAPI标准接口 |

> **说明**: 只要播放器支持 **dandanplay API** 格式的自定义弹幕接口,都可以使用本服务。
>
> **API 说明**:
> - **自动匹配(match)**: 根据文件名自动匹配弹幕，需开启匹配后备功能
> - **手动搜索(anime)**: 通过使用anime接口手动搜索动画/剧集
> - **手动搜索(episodes)**: 通过使用episodes接口手动搜索分集列表，该接口❌不支持后备搜索

---

### Yamby

**平台**: Android

**版本要求**: 1.5.9.11 或更高

**配置步骤**:
1. 打开 Yamby 设置
2. 进入 **"弹幕设置"** → **"自定义弹幕接口"**
3. 填入弹幕接口地址:
   ```
   http://192.168.1.100:7768/api/v1/Q2KHYcveM0SaRKvxomQm
   ```
4. 保存设置

**支持功能**:
- ✅ 自动匹配弹幕
- ✅ 手动搜索弹幕
- ✅ 弹幕样式自定义
- ✅ 弹幕时间轴调整
- ✅ 弹幕过滤

---

### Hills

**平台**: Android/Windows

**版本要求**: Android 1.4.2 或更高 / Windows 0.2.8 或更高

**配置步骤**:
1. 打开 Hills 设置
2. 进入 **"弹幕设置"** → **"自定义弹幕源"**
3. 填入弹幕接口地址:
   ```
   http://192.168.1.100:7768/api/v1/Q2KHYcveM0SaRKvxomQm
   ```
4. 保存设置

**支持功能**:
- ✅ 自动匹配弹幕
- ✅ 手动搜索弹幕
- ✅ 弹幕时间轴调整
- ✅ 弹幕过滤
- ✅ 弹幕样式自定义

---

### 小幻影视

**平台**: Windows

**版本要求**: 无特殊要求

**配置步骤**:
1. 打开小幻影视设置
2. 进入 **"弹幕设置"** → **"自定义弹幕接口"**
3. 填入弹幕接口地址(支持两种格式):
   ```
   http://192.168.1.100:7768/api/v1/Q2KHYcveM0SaRKvxomQm
   ```
   或
   ```
   http://192.168.1.100:7768/api/v1/Q2KHYcveM0SaRKvxomQm/api/v2
   ```
4. 保存设置

**支持功能**:
- ✅ 支持 `/api/v2` 路径
- ✅ 自动匹配弹幕
- ✅ 手动搜索弹幕
- ✅ 弹幕样式自定义

---

### SenPlayer

**平台**: iOS

**版本要求**: 5.7 或更高

**配置步骤**:
1. 打开 SenPlayer 设置
2. 进入 **"弹幕设置"** → **"自定义弹幕源"**
3. 填入弹幕接口地址:
   ```
   http://192.168.1.100:7768/api/v1/Q2KHYcveM0SaRKvxomQm
   ```
4. 保存设置

**支持功能**:
- ✅ 支持 ISO 文件播放
- ✅ 自动匹配弹幕
- ✅ 手动搜索弹幕
- ✅ 弹幕样式自定义

---

### Afusekt

**平台**: Android/Android TV

**版本要求**: 2.9.6 或更高

**配置步骤**:
1. 打开 Afusekt 设置
2. 进入 **"弹幕设置"** → **"自定义弹幕接口"**
3. 填入弹幕接口地址:
   ```
   http://192.168.1.100:7768/api/v1/Q2KHYcveM0SaRKvxomQm
   ```
4. 保存设置

**支持功能**:
- ✅ 自动匹配弹幕
- ✅ 手动搜索弹幕
- ✅ 弹幕样式自定义
- ✅ 弹幕时间轴调整

---

### dd-danmaku (chen3861229)

**平台**: 浏览器/客户端/服务端插件

**版本要求**: 1.47 或更高

**项目地址**: [https://github.com/chen3861229/dd-danmaku](https://github.com/chen3861229/dd-danmaku)

**安装步骤**:

**浏览器插件安装**:
1. 访问项目地址下载插件
2. 在浏览器中打开扩展程序管理页面:
   - Chrome: `chrome://extensions/`
   - Edge: `edge://extensions/`
3. 启用 **"开发者模式"** 或 **"开发人员模式"**
4. 点击 **"加载已解压的扩展程序"** 或 **"加载解压缩的扩展"**,选择插件文件夹
5. 插件安装完成

**客户端/服务端插件安装**:
1. 访问项目地址下载客户端安装包
2. 运行安装程序
3. 按照提示完成安装

**配置步骤**:
1. 点击浏览器工具栏中的插件图标(或打开客户端)
2. 进入 **"设置"** 页面
3. 填入弹幕接口地址:
   ```
   http://192.168.1.100:7768/api/v1/Q2KHYcveM0SaRKvxomQm
   ```
4. 保存设置

**支持功能**:
- ✅ 自动匹配弹幕(match)
- ❌ 手动搜索(anime)
- ✅ 手动搜索(episodes)
- ✅ 弹幕样式自定义
- ✅ 弹幕时间轴调整
- ✅ 支持多个视频网站

**支持的视频网站**:
- Bilibili (哔哩哔哩)
- YouTube
- 其他支持 HTML5 视频播放的网站

---

### dd-danmaku (l429609201)

**平台**: 浏览器/客户端/服务端插件

**版本要求**: 1.0.0 或更高

**项目地址**: [https://github.com/l429609201/dd-danmaku](https://github.com/l429609201/dd-danmaku)

**安装步骤**:

**浏览器插件安装**:
1. 访问项目地址下载插件
2. 在浏览器中打开扩展程序管理页面:
   - Chrome: `chrome://extensions/`
   - Edge: `edge://extensions/`
3. 启用 **"开发者模式"** 或 **"开发人员模式"**
4. 点击 **"加载已解压的扩展程序"** 或 **"加载解压缩的扩展"**,选择插件文件夹
5. 插件安装完成

**客户端/服务端插件安装**:
1. 访问项目地址下载客户端安装包
2. 运行安装程序
3. 按照提示完成安装

**配置步骤**:
1. 点击浏览器工具栏中的插件图标(或打开客户端)
2. 进入 **"设置"** 页面
3. 填入弹幕接口地址:
   ```
   http://192.168.1.100:7768/api/v1/Q2KHYcveM0SaRKvxomQm
   ```
4. 保存设置

**支持功能**:
- ✅ 自动匹配弹幕(match)
- ✅ 手动搜索(anime)
- ❌ 手动搜索(episodes)
- ✅ 弹幕样式自定义
- ✅ 弹幕时间轴调整
- ✅ 支持多个视频网站

**支持的视频网站**:
- Bilibili (哔哩哔哩)
- YouTube
- 其他支持 HTML5 视频播放的网站

---

### 其他播放器

只要播放器支持 **dandanplay API** 格式的自定义弹幕接口,都可以使用本服务。

**配置方法**:
1. 在播放器的弹幕设置中找到 **"自定义弹幕接口"** 或 **"自定义弹幕源"** 选项
2. 填入本服务的弹幕接口地址
3. 保存设置

**测试方法**:
1. 配置完成后播放任意视频
2. 查看是否能够加载弹幕
3. 如果无法加载,请参考 [常见问题](#常见问题) 部分

---

## 常见问题

### Q: 如何测试弹幕接口是否配置成功?

A:
1. 在播放器中播放任意视频
2. 查看是否能够加载弹幕
3. 如果无法加载,检查:
   - 服务器IP和端口是否正确
   - Token是否正确
   - 网络连接是否正常
   - Token是否已过期

### Q: Token过期后怎么办?

A:
1. 在 Web UI 的 **"弹幕" → "Token管理"** 页面查看Token状态
2. 如果Token已过期,创建一个新的Token
3. 在播放器中更新弹幕接口地址

### Q: 可以为不同的播放器创建不同的Token吗?

A: 可以。建议为每个播放器创建独立的Token,这样可以:
- 更好地管理和追踪Token使用情况
- 单独设置每个Token的调用限制
- 在需要时单独撤销某个Token

### Q: 如何限制Token的调用次数?

A: 在创建Token时,可以设置 **"每日调用限制"**:
- 设置为 `-1` 表示无限制
- 设置为正整数表示每日最大调用次数
- 超过限制后,Token将在当天剩余时间内无法使用

### Q: 播放器提示"无法连接到弹幕服务器"怎么办?

A: 检查以下几点:
1. **网络连接**: 确保播放器设备能够访问服务器IP
2. **防火墙**: 确保服务器防火墙允许端口访问
3. **服务状态**: 确保弹幕服务正在运行
4. **接口格式**: 确保弹幕接口地址格式正确

### Q: 如何查看Token的使用情况?

A: 在 Web UI 的 **"弹幕" → "Token管理"** 页面可以查看:
- Token的创建时间
- Token的有效期
- Token的调用次数
- Token的状态(正常/已过期)

---

## 相关文档

- [快速开始](快速开始.md)
- [弹幕功能配置](弹幕功能配置.md)
- [常见问题](常见问题.md)

---

## 项目参考

本项目参考了 [dandanplay API](https://api.dandanplay.net/swagger/index.html),同时增加了使用访问令牌管理弹幕API,支持上述多种播放器客户端。
