# 元数据源配置指南

本指南将帮助您配置各个元数据源的 API 密钥和相关设置,以便系统能够从这些源获取影视作品的详细信息。

## 📋 支持的元数据源

| 元数据源 | 用途 | 是否需要 API Key | 推荐优先级 |
|---------|------|----------------|-----------|
| **TMDB** | 获取电影和剧集的详细信息、海报、季度信息等 | ✅ 是 | ⭐⭐⭐⭐⭐ |
| **TVDB** | 获取电视剧的详细信息和分集列表 | ✅ 是 | ⭐⭐⭐⭐ |
| **Bangumi** | 获取动画、日剧等 ACG 作品信息 | ⚠️ 可选 | ⭐⭐⭐ |
| **Douban** | 获取豆瓣评分和中文信息 | ⚠️ 可选 | ⭐⭐ |
| **IMDb** | 获取 IMDb 评分和国际信息 | ❌ 否 | ⭐⭐⭐ |

> **提示**: TMDB 是最重要的元数据源,强烈建议优先配置。

---

## 🎬 TMDB (The Movie Database)

### 为什么需要 TMDB?

TMDB 是全球最大的开放电影数据库之一,提供:
- 电影和电视剧的详细信息(标题、简介、演员、导演等)
- 高质量的海报和剧照
- 多语言支持(包括中文)
- 季度和分集信息
- 与其他服务(如 Plex, Emby, Jellyfin)的良好集成

### 如何获取 TMDB API Key?

1. **注册账号**
   - 访问 [TMDB 官网](https://www.themoviedb.org/)
   - 点击右上角 "Join TMDB" 注册账号
   - 验证邮箱并登录

2. **申请 API Key**
   - 登录后,点击右上角头像 → "Settings" (设置)
   - 在左侧菜单选择 "API"
   - 点击 "Request an API Key" (申请 API 密钥)
   - 选择 "Developer" (开发者)类型
   - 填写申请表单:
     - **Application Name**: 填写 `Misaka Danmu Server` 或任意名称
     - **Application URL**: 填写 `http://localhost:7768` 或您的实际域名
     - **Application Summary**: 填写 `Personal media library danmaku service`
   - 同意服务条款并提交

3. **获取 API Key**
   - 申请通过后(通常是即时的),您会看到两个密钥:
     - **API Key (v3 auth)**: 这是您需要的密钥 ✅
     - **API Read Access Token (v4 auth)**: 暂不需要
   - 复制 **API Key (v3 auth)** 的值

### 在系统中配置 TMDB

1. 登录 Web UI
2. 进入 "设置" → "搜索源"
3. 找到 "TMDB API Key" 配置项
4. 粘贴您的 API Key
5. 点击 "保存配置"



### 高级配置

- **TMDB API Base URL**: 默认为 `https://api.themoviedb.org`,通常无需修改
- **TMDB Image Base URL**: 默认为 `https://image.tmdb.org`,用于加载海报图片

---

## 📺 TVDB (TheTVDB)

### 为什么需要 TVDB?

TVDB 专注于电视剧数据,提供:
- 详细的分集信息和播出日期
- 多季度剧集的完整数据
- 与 Plex, Emby 等媒体服务器的良好集成

### 如何获取 TVDB API Key?

1. **注册账号**
   - 访问 [TVDB 官网](https://thetvdb.com/)
   - 点击 "Register" 注册账号
   - 验证邮箱并登录

2. **申请 API Key**
   - 登录后,点击右上角用户名 → "Dashboard"
   - 在左侧菜单选择 "API Keys"
   - 点击 "Create API Key"
   - 填写表单:
     - **Name**: 填写 `Misaka Danmu Server`
     - **Description**: 填写 `Personal danmaku service`
   - 点击 "Create"

3. **获取 API Key**
   - 创建成功后,您会看到 API Key
   - 复制该密钥

### 在系统中配置 TVDB

1. 登录 Web UI
2. 进入 "设置" → "搜索源"
3. 找到 "TVDB API Key" 配置项
4. 粘贴您的 API Key
5. 点击 "保存配置"



---

## 🎭 Bangumi (番组计划)

### 为什么需要 Bangumi?

Bangumi 是专注于 ACG(动画、漫画、游戏)的中文数据库,提供:
- 动画、日剧、特摄等作品的详细信息
- 中文标题和别名
- 播出时间和分集信息
- 用户评分和评论

### 如何配置 Bangumi?

Bangumi 支持三种使用方式:

#### 方式 1: Access Token (推荐)

**特点**: 简单快速,无需 OAuth 授权流程。

**如何获取 Access Token**:

1. 访问 [Bangumi 开发者中心](https://bgm.tv/dev/app)
2. 登录您的 Bangumi 账号
3. 点击 "创建新应用"
4. 填写应用信息:
   - **应用名称**: `Misaka Danmu Server`
   - **回调地址**: `http://localhost:7768` (可随意填写)
5. 创建成功后,点击应用名称进入详情页
6. 在 "Access Token" 部分,点击 "生成新的 Access Token"
7. 复制生成的 Access Token

**在系统中配置**:
- 登录 Web UI → "设置" → "搜索源"
- 找到 "Bangumi Access Token" 配置项
- 粘贴您的 Access Token
- 保存配置


#### 方式 2: OAuth 认证 (多用户场景)

**特点**: 支持多用户授权,每个用户使用自己的 Bangumi 账号。

**如何配置**:

1. **创建应用**
   - 访问 [Bangumi 开发者中心](https://bgm.tv/dev/app)
   - 登录您的 Bangumi 账号
   - 点击 "创建新应用"
   - 填写应用信息:
     - **应用名称**: `Misaka Danmu Server`
     - **回调地址**: `http://your-domain:7768/api/metadata/bangumi/auth/callback` (替换为您的实际域名)
   - 提交申请

2. **获取凭证**
   - 创建成功后,您会获得:
     - **App ID** (Client ID)
     - **App Secret** (Client Secret)

3. **在系统中配置**
   - 登录 Web UI → "设置" → "搜索源"
   - 填写 "Bangumi Client ID" 和 "Bangumi Client Secret"
   - 保存配置

4. **用户授权**
   - 用户在 Web UI 中点击 "Bangumi 授权" 按钮
   - 跳转到 Bangumi 授权页面
   - 授权成功后,系统会自动保存用户的 Access Token





## 📖 Douban (豆瓣)

### 为什么需要 Douban?

豆瓣提供:
- 中文影视作品信息
- 豆瓣评分
- 中文简介和演员信息

### 如何配置 Douban?

> ⚠️ **注意**: 豆瓣没有公开的官方 API,系统通过网页解析获取数据。

#### 可选: 配置 Cookie (提高稳定性)

如果您遇到豆瓣访问限制,可以配置 Cookie:

1. **获取 Cookie**
   - 使用浏览器访问 [豆瓣](https://www.douban.com/)
   - 登录您的豆瓣账号
   - 按 F12 打开开发者工具
   - 切换到 "Network" (网络)标签
   - 刷新页面
   - 找到任意请求,查看 "Request Headers"
   - 复制 `Cookie` 字段的完整值

2. **在系统中配置**
   - 登录 Web UI → "设置" → "搜索源"
   - 填写 "Douban Cookie"
   - 保存配置



---

## 🎥 IMDb (Internet Movie Database)

### 为什么需要 IMDb?

IMDb 提供:
- 全球最权威的电影数据库
- IMDb 评分
- 国际化的影视信息

### 如何配置 IMDb?

IMDb 无需 API Key,系统支持两种获取方式:

#### 方式 1: 第三方 API (默认,推荐)
- 使用 `api.imdbapi.dev` 提供的免费 API
- 无需配置,开箱即用
- 稳定性较高

#### 方式 2: 官网 HTML 解析 (备用)
- 直接解析 IMDb 官网页面
- 作为方式 1 的备用方案

### 配置选项

在 Web UI → "设置" → "搜索源" 中:

- **IMDb 使用 API**: 是否使用第三方 API (默认: 是)
- **IMDb 启用兜底机制**: 当主方式失败时自动尝试另一种方式 (默认: 是)



---

## 🔧 元数据源优先级设置

在 Web UI → "设置" → "搜索源" 中,您可以:

1. **启用/禁用元数据源**: 勾选或取消勾选对应的源
2. **调整优先级**: 拖动排序,越靠前优先级越高
3. **配置缓存时间**: 调整元数据搜索结果的缓存时间(默认 3 小时)

### 推荐配置

**电影和美剧**:
1. TMDB (必须)
2. IMDb
3. Douban

**电视剧**:
1. TMDB (必须)
2. TVDB
3. IMDb

**动画和日剧**:
1. TMDB (必须)
2. Bangumi
3. Douban

---

## ❓ 常见问题

### Q: 我必须配置所有元数据源吗?
A: 不需要。至少配置 **TMDB** 即可满足大部分需求。其他源可根据您的媒体库类型选择性配置。

### Q: API Key 配置后多久生效?
A: 立即生效。保存配置后,系统会在下次搜索时使用新的 API Key。

### Q: TMDB API Key 有调用次数限制吗?
A: TMDB 免费 API 有速率限制(每 10 秒 40 次请求),但对个人使用完全足够。系统内置了缓存机制,可以减少 API 调用。

### Q: 为什么配置了 API Key 还是搜索不到结果?
A: 请检查:
1. API Key 是否正确(没有多余空格)
2. 网络是否能访问对应的 API 服务
3. 查看系统日志中是否有错误信息

### Q: 可以使用代理访问元数据源吗?
A: 可以。在 "设置" → "网络" 中配置全局代理,所有元数据源请求都会通过代理。

---

## 📚 相关文档

- [快速开始](快速开始.md)
- [AI 功能配置](AI功能配置.md)
- [常见问题](常见问题.md)

