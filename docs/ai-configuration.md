# AI 功能配置指南

本指南将帮助您配置 AI 功能,包括 AI 智能匹配、AI 识别增强、AI 别名验证等功能。

## 📋 AI 功能概览

| 功能 | 说明 | 使用场景 |
|------|------|---------|
| **AI 智能匹配** | 使用 AI 从多个搜索结果中选择最佳匹配 | 当搜索结果有多个相似项时,AI 帮助选择最准确的一个 |
| **AI 季度映射** | 使用 AI 从元数据源搜索结果中选择正确的季度 | 多季度剧集匹配时,AI 帮助识别正确的季度编号 |
| **AI 识别增强** | 使用 AI 从文件名中提取结构化信息 | 当文件名格式复杂或不规范时,AI 帮助识别标题和季度信息 |
| **AI 别名验证** | 使用 AI 验证和分类别名 | 验证别名是否真正属于该作品,识别语言类型(中文/英文/日文/罗马音) |
| **AI 别名扩展** | 使用 AI 生成可能的别名 | 当元数据源返回非中文标题时,AI 生成中文译名、罗马音等别名用于搜索 |

---

## 🤖 支持的 AI 提供商

### 1. DeepSeek (推荐)

**特点**:
- ✅ 性价比最高的国产大模型
- ✅ 支持余额查询
- ✅ 响应速度快
- ✅ 中文理解能力强

**如何获取 API Key**:

1. 访问 [DeepSeek 官网](https://platform.deepseek.com)
2. 注册并登录账号
3. 进入 "API Keys" 页面
4. 点击 "Create API Key"
5. 复制生成的 API Key (以 `sk-` 开头)

**配置示例**:
- **AI 提供商**: DeepSeek
- **API Key**: `sk-xxxxxxxxxxxxxxxxxxxxxxxx`
- **Base URL**: 留空(使用默认 `https://api.deepseek.com`)
- **模型名称**: `deepseek-chat`

**费用参考**:
- 输入: ¥1/百万 tokens
- 输出: ¥2/百万 tokens
- 新用户通常有免费额度

---

### 2. SiliconFlow (硅基流动)

**特点**:
- ✅ 支持多种开源大模型
- ✅ 支持余额查询
- ✅ 国内访问速度快
- ✅ 新用户有免费额度

**如何获取 API Key**:

1. 访问 [SiliconFlow 官网](https://siliconflow.cn)
2. 注册并登录账号
3. 进入 "API Keys" 页面
4. 点击 "创建新的 API Key"
5. 复制生成的 API Key (以 `sk-` 开头)

**配置示例**:
- **AI 提供商**: SiliconFlow
- **API Key**: `sk-xxxxxxxxxxxxxxxxxxxxxxxx`
- **Base URL**: 留空(使用默认 `https://api.siliconflow.cn/v1`)
- **模型名称**: `Qwen/Qwen2.5-7B-Instruct` 或 `deepseek-ai/DeepSeek-V2.5`

**推荐模型**:
- `Qwen/Qwen2.5-7B-Instruct` - 通义千问,中文能力强
- `deepseek-ai/DeepSeek-V2.5` - DeepSeek 模型
- `Qwen/Qwen2.5-72B-Instruct` - 更强大的模型(费用更高)

---

### 3. OpenAI (兼容接口)

**特点**:
- ✅ 支持 OpenAI 官方 API
- ✅ 支持兼容 OpenAI API 的第三方服务
- ⚠️ 不支持余额查询
- ⚠️ 国内访问可能需要代理

**如何获取 API Key**:

**方式 1: OpenAI 官方**
1. 访问 [OpenAI Platform](https://platform.openai.com)
2. 注册并登录账号
3. 进入 "API Keys" 页面
4. 点击 "Create new secret key"
5. 复制生成的 API Key (以 `sk-` 开头)

**方式 2: 第三方兼容服务**
- 使用支持 OpenAI API 格式的第三方服务(如 Azure OpenAI, 各种中转服务等)
- 获取对应服务的 API Key 和 Base URL

**配置示例**:
- **AI 提供商**: OpenAI
- **API Key**: `sk-xxxxxxxxxxxxxxxxxxxxxxxx`
- **Base URL**: `https://api.openai.com/v1` (官方) 或自定义兼容接口
- **模型名称**: `gpt-4-turbo`, `gpt-4`, `gpt-3.5-turbo`

---

### 4. Google Gemini

**特点**:
- ✅ Google 的多模态 AI 模型
- ✅ 免费额度较高
- ✅ 使用官方 SDK
- ⚠️ 不支持余额查询
- ⚠️ 国内访问需要代理

**如何获取 API Key**:

1. 访问 [Google AI Studio](https://ai.google.dev)
2. 使用 Google 账号登录
3. 点击 "Get API Key"
4. 创建新的 API Key
5. 复制生成的 API Key (通常以 `AI` 开头)

**配置示例**:
- **AI 提供商**: Google Gemini
- **API Key**: `AIzaSyxxxxxxxxxxxxxxxxxxxxxxxx`
- **Base URL**: 留空(使用官方 SDK)
- **模型名称**: `gemini-1.5-flash`, `gemini-1.5-pro`, `gemini-2.0-flash-exp`

**推荐模型**:
- `gemini-1.5-flash` - 速度快,适合大部分场景
- `gemini-1.5-pro` - 更强大,适合复杂任务
- `gemini-2.0-flash-exp` - 实验性最新模型

**免费额度**:
- Gemini 1.5 Flash: 每分钟 15 次请求
- Gemini 1.5 Pro: 每分钟 2 次请求

---

## ⚙️ 在系统中配置 AI

###  Web UI 配置 

1. 登录 Web UI
2. 进入 "设置" → "AI辅助增强" → "AI连接配置"
3. 在 "AI 连接配置" 卡片中:
   - 选择 **AI 提供商**
   - 填写 **API Key**
   - (可选) 填写 **Base URL** (通常留空使用默认值)
   - 填写 **模型名称**
4. 点击 "测试 AI 连接" 验证配置
5. 点击 "保存 AI 连接配置"



---

## 🎯 AI 功能详细说明

### 1. AI 智能匹配

**功能**: 当搜索结果有多个相似项时,使用 AI 选择最佳匹配。

**启用方式**:
- Web UI → "设置" → "AI辅助增强" →  "AI 自动匹配"
- 将 "匹配模式" 设置为 "AI 智能匹配"

**使用场景**:
- 同名作品有多个版本(如电影重拍、不同年份的剧集)
- 搜索结果中有相似但不同的作品
- 需要根据年份、类型等信息精确匹配

**自定义提示词**:
- 点击 "填充默认提示词" 查看默认提示词
- 可根据需要自定义提示词以优化匹配效果

---

### 2. AI 季度映射

**功能**: 从元数据源搜索结果中选择正确的季度。

**启用方式**:
- Web UI → "设置" → "AI辅助增强" →  "AI 自动匹配"
- 启用对应场景的 "TMDB 季度映射":
  - Webhook TMDB 季度映射
  - 匹配后备 TMDB 季度映射
  - 全自动导入 TMDB 季度映射

**使用场景**:
- 多季度剧集匹配
- 季度编号不规范的情况
- 需要从多个搜索结果中选择正确季度

**配置选项**:
- **季度映射元数据源**: 选择用于季度映射的元数据源(TMDB, TVDB, IMDb, Douban, Bangumi)
- **AI 季度映射提示词**: 自定义提示词以优化季度选择

---

### 3. AI 识别增强

**功能**: 从文件名中提取结构化信息(标题、季度、集数等)。

**启用方式**:
- Web UI → "设置" → "AI辅助增强" → "AI 自动匹配"
- 启用 "AI 识别增强"

**使用场景**:
- 文件名格式不规范
- 文件名包含复杂的标题和季度信息
- 需要从文件名中提取准确的元数据

**示例**:
- 输入: `[某字幕组] 进击的巨人 最终季 Part 2 - 01 [1080P].mkv`
- AI 识别: 标题=`进击的巨人`, 季度=`4`, 集数=`1`

---

### 4. AI 别名验证

**功能**: 验证和分类别名,识别语言类型。

**启用方式**:
- Web UI → "设置" → "AI辅助增强" → "AI 自动匹配"
- 启用 "AI 别名验证"

**使用场景**:
- 验证别名是否真正属于该作品
- 识别别名的语言类型(中文/英文/日文/罗马音)
- 过滤无关或错误的别名

---

### 5. AI 别名扩展

**功能**: 生成可能的别名用于搜索。

**启用方式**:
- Web UI → "设置" → "AI辅助增强" → "AI 自动匹配"
- 启用 "AI 别名扩展"

**使用场景**:
- 元数据源返回非中文标题
- 需要在中文弹幕源中搜索
- 扩展搜索范围以提高匹配成功率

**示例**:
- 输入: `Attack on Titan`
- AI 扩展: `进击的巨人`, `Shingeki no Kyojin`, `AOT`

---

## 💡 最佳实践

### 1. 选择合适的 AI 提供商

- **个人使用**: 推荐 **DeepSeek** 或 **SiliconFlow**,性价比高
- **高频使用**: 推荐 **DeepSeek**,费用低且稳定
- **国际用户**: 推荐 **Gemini**,免费额度高
- **企业用户**: 推荐 **OpenAI**,质量最高

### 2. 合理启用 AI 功能

- **必须启用**: AI 智能匹配(核心功能)
- **推荐启用**: AI 季度映射(多季度剧集)
- **按需启用**: AI 识别增强、别名验证、别名扩展

### 3. 监控 API 使用

- 定期查看余额(DeepSeek 和 SiliconFlow 支持)
- 启用 "记录响应" 查看 AI 返回的详细信息
- 根据日志优化提示词

### 4. 自定义提示词

- 点击 "填充默认提示词" 查看默认提示词
- 根据您的媒体库特点调整提示词
- 测试并迭代优化

---

## ❓ 常见问题

### Q: AI 功能必须配置吗?
A: 不是必须的。AI 功能是可选的增强功能,不配置也可以正常使用弹幕服务。

### Q: 哪个 AI 提供商最便宜?
A: DeepSeek 性价比最高,输入 ¥1/百万 tokens,输出 ¥2/百万 tokens。

### Q: AI 功能会消耗很多费用吗?
A: 不会。AI 功能仅在匹配时调用,每次调用消耗的 tokens 很少,通常每月费用不超过几元。

### Q: 测试 AI 连接失败怎么办?
A: 请检查:
1. API Key 是否正确(没有多余空格)
2. 网络是否能访问 AI 服务(国外服务可能需要代理)
3. 模型名称是否正确
4. 查看系统日志中的详细错误信息

### Q: 可以同时使用多个 AI 提供商吗?
A: 不可以。系统同时只能配置一个 AI 提供商。

### Q: Gemini 在国内无法访问怎么办?
A: 需要配置代理。在 "设置" → "代理设置" 中配置全局代理,所有 AI 请求都会通过代理。

---

## 📚 相关文档

- [元数据源配置](metadata-sources.md)
- [快速开始](quick-start.md)
- [常见问题](faq.md)

